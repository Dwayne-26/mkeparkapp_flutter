default_platform(:android)

platform :android do
  desc "Upload Flutter bundle to Google Play"
  lane :release do
    track = ENV.fetch("PLAY_TRACK", "internal")
    status = ENV.fetch("PLAY_RELEASE_STATUS", "draft")
    aab_path = ENV.fetch("PLAY_AAB_PATH", "../build/app/outputs/bundle/release/app-release.aab")

    unless File.exist?(aab_path)
      UI.user_error!("AAB not found at #{aab_path}")
    end

    supply(
      track: track,
      release_status: status,
      aab: aab_path,
      skip_upload_metadata: true,
      skip_upload_images: true,
      skip_upload_screenshots: true
    )
  end
end
